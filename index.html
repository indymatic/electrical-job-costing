<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Circle City Estimator/Job Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.22.5/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #1C2526;
      color: #FFFFFF;
      font-size: 16px;
    }
    .container {
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      max-width: 1000px;
      width: 100%;
      background: #2A2F30;
      margin: 1rem;
      box-sizing: border-box;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    .header i {
      margin-right: 0.5rem;
      color: #E82127;
      font-size: 1.5rem;
    }
    h1, h2 {
      font-weight: 600;
      text-transform: uppercase;
    }
    h1 {
      font-size: 1.5rem;
      text-align: center;
    }
    h2 {
      font-size: 1.1rem;
    }
    h3 {
      font-size: 1rem;
      margin-top: 1rem;
    }
    button {
      background: #E82127;
      color: #FFFFFF;
      border: none;
      padding: 0.75rem 1.25rem;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1rem;
      transition: background 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      max-width: 300px;
      margin: 0 auto;
    }
    button:hover {
      background: #C71B22;
    }
    button i {
      margin-right: 0.5rem;
    }
    input, select, textarea {
      border: 1px solid #4A5051;
      border-radius: 8px;
      padding: 0.75rem;
      width: 100%;
      box-sizing: border-box;
      background: #3A4041;
      color: #FFFFFF;
      font-size: 1rem;
    }
    input:focus, select:focus, textarea:focus {
      border-color: #E82127;
      outline: none;
    }
    textarea {
      min-height: 100px;
    }
    .relative {
      position: relative;
    }
    .relative i {
      color: #B0B0B0;
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
    }
    .relative input, .relative textarea {
      padding-left: 2.5rem;
    }
    .relative select {
      padding-left: 2.5rem;
    }
    .table-container {
      overflow-x: auto;
      width: 100%;
    }
    table {
      border-radius: 8px;
      overflow: hidden;
      background: #2A2F30;
      width: 100%;
      border-collapse: collapse;
    }
    thead tr {
      background: #3A4041;
    }
    th, td {
      border: 1px solid #4A5051;
      padding: 0.5rem;
      font-size: 0.9rem;
      text-align: left;
    }
    tbody tr:hover {
      background: #353A3B;
    }
    .text-gray-600 {
      color: #B0B0B0;
    }
    label {
      font-weight: 400;
      margin-bottom: 0.25rem;
      display: block;
      color: #B0B0B0;
      font-size: 0.9rem;
    }
    .space-y-4 > * + * {
      margin-top: 1rem;
    }
    .space-x-4 {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .bg-gray-500 {
      background: #4A5051;
    }
    .bg-gray-500:hover {
      background: #5A6061;
    }
    .bg-red-600 {
      background: #E82127;
    }
    .bg-red-600:hover {
      background: #C71B22;
    }
    .text-red-600 {
      color: #E82127;
    }
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .dashboard-card {
      padding: 0.75rem;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      background: #3A4041;
      text-align: center;
    }
    .dashboard-card h3 {
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }
    .dashboard-card p {
      font-size: 1.1rem;
      font-weight: 600;
    }
    .footer-text {
      text-align: center;
      margin-top: 1rem;
      font-size: 0.8rem;
    }
    .footer-text-powered {
      font-weight: 600;
      color: #E82127;
    }
    .footer-text-built {
      font-size: 0.7rem;
      color: #B0B0B0;
    }
    .suggestions {
      background: #3A4041;
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    .suggestions p {
      margin: 0.5rem 0;
      font-size: 1rem;
      color: #FFFFFF;
    }
    .grid-cols-2 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }
    .grid-cols-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }
    @media (max-width: 768px) {
      .container {
        padding: 1rem;
        margin: 0.5rem;
      }
      h1 {
        font-size: 1.25rem;
      }
      h2 {
        font-size: 1rem;
      }
      button {
        padding: 0.75rem;
        font-size: 0.9rem;
        width: 100%;
        max-width: none;
      }
      input, select, textarea {
        padding: 0.75rem;
        font-size: 0.9rem;
      }
      .relative i {
        font-size: 0.9rem;
      }
      .grid-cols-2, .grid-cols-3 {
        grid-template-columns: 1fr;
      }
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      .dashboard-card {
        padding: 0.5rem;
      }
      .dashboard-card h3 {
        font-size: 0.8rem;
      }
      .dashboard-card p {
        font-size: 1rem;
      }
      .table-container {
        overflow-x: auto;
      }
      table {
        min-width: 600px;
      }
      th, td {
        font-size: 0.8rem;
        padding: 0.4rem;
      }
      .space-x-4 {
        flex-direction: column;
        align-items: center;
      }
      .space-x-4 button {
        width: 100%;
        max-width: 200px;
      }
    }
    @media (max-width: 480px) {
      .container {
        padding: 0.75rem;
      }
      h1 {
        font-size: 1rem;
      }
      h2 {
        font-size: 0.9rem;
      }
      button {
        padding: 0.5rem;
        font-size: 0.8rem;
      }
      input, select, textarea {
        padding: 0.5rem;
        font-size: 0.8rem;
      }
      .relative i {
        font-size: 0.8rem;
      }
      .dashboard-card h3 {
        font-size: 0.7rem;
      }
      .dashboard-card p {
        font-size: 0.9rem;
      }
      th, td {
        font-size: 0.7rem;
        padding: 0.3rem;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const { createRoot } = ReactDOM;

    function App() {
      const [isLoggedIn, setIsLoggedIn] = useState(false);
      const [username, setUsername] = useState('');
      const [password, setPassword] = useState('');
      const [confirmPassword, setConfirmPassword] = useState('');
      const [showPassword, setShowPassword] = useState(false);
      const [isSigningUp, setIsSigningUp] = useState(false);
      const [message, setMessage] = useState('');
      const [jobs, setJobs] = useState([]);
      const [jobName, setJobName] = useState('');
      const [createdBy, setCreatedBy] = useState('');
      const [dateEntered, setDateEntered] = useState('');
      const [selectedJobId, setSelectedJobId] = useState(null);
      const [costEstimates, setCostEstimates] = useState({});
      const [costEstimate, setCostEstimate] = useState({
        labor: { hours: "", technicians: "", pricePerHour: "", totalLaborCost: "" },
        materials: [],
        materialMarkup: "",
        taxRate: "",
        specialSections: [],
        totalCost: "",
        runningCost: "",
        nextSteps: ''
      });
      const [newMaterial, setNewMaterial] = useState({ name: '', cost: '', quantity: '' });
      const [newCustomMaterial, setNewCustomMaterial] = useState({ name: '', cost: '' });
      const [newSpecialSection, setNewSpecialSection] = useState({ name: '', cost: '', description: '' });
      const [currentPage, setCurrentPage] = useState('login');
      const [isLoadingJob, setIsLoadingJob] = useState(false);
      const [materialType, setMaterialType] = useState('Residential');
      const [customMaterials, setCustomMaterials] = useState([]);
      const [suggestions, setSuggestions] = useState({ averageCost: "", minCost: "", maxCost: "", count: 0 });

      // Use environment variable for server URL
      const SERVER_URL = process.env.SERVER_URL || 'http://localhost:5000';

      // Cache system: Load jobs and estimates from localStorage if available
      useEffect(() => {
        const cachedJobs = localStorage.getItem('cachedJobs');
        const cachedEstimates = localStorage.getItem('cachedCostEstimates');
        if (cachedJobs) {
          setJobs(JSON.parse(cachedJobs));
        }
        if (cachedEstimates) {
          setCostEstimates(JSON.parse(cachedEstimates));
        }
      }, []);

      // Save jobs and estimates to localStorage whenever they change
      useEffect(() => {
        if (jobs.length > 0) {
          localStorage.setItem('cachedJobs', JSON.stringify(jobs));
        }
        if (Object.keys(costEstimates).length > 0) {
          localStorage.setItem('cachedCostEstimates', JSON.stringify(costEstimates));
        }
      }, [jobs, costEstimates]);

      const residentialMaterials = [
        { name: "Romex 14/2 (per foot)" },
        { name: "Romex 12/2 (per foot)" },
        { name: "Junction Box (4x4)" },
        { name: "Decora Outlet (15A)" },
        { name: "Decora GFCI Outlet (15A)" },
        { name: "Decora Switch" },
        { name: "Dimmer Switch" },
        { name: "LED Recessed Light" },
        { name: "Ceiling Light Fixture" },
        { name: "Smoke Detector" }
      ];

      const commercialMaterials = [
        { name: "EMT Conduit 1\" (per foot)" },
        { name: "THHN Wire 10 AWG (per foot)" },
        { name: "Junction Box (6x6)" },
        { name: "Commercial Receptacle (20A)" },
        { name: "GFCI Receptacle (20A)" },
        { name: "Occupancy Sensor" },
        { name: "LED Panel Light (2x4)" },
        { name: "High Bay LED Light" },
        { name: "Exit Sign (LED)" },
        { name: "Fire Alarm Pull Station" }
      ];

      const availableMaterials = [
        ...(materialType === 'Residential' ? residentialMaterials : commercialMaterials),
        ...customMaterials
      ];

      useEffect(() => {
        if (isLoggedIn) {
          fetchJobs();
          fetchAllCostEstimates();
        }
      }, [isLoggedIn]);

      useEffect(() => {
        if (selectedJobId) {
          const selectedJob = jobs.find(job => job._id === selectedJobId);
          if (!selectedJob) {
            setMessage('Oops! Job not found. Let’s go back to the dashboard.');
            setIsLoadingJob(false);
            setSelectedJobId(null);
            return;
          }
          setIsLoadingJob(true);
          Promise.all([
            fetchCostEstimate(selectedJobId).catch(error => {
              console.error("Error fetching cost estimate:", error);
              setMessage('Oops! Couldn’t load the estimate. Using cached data if available.');
              return null;
            }),
            fetchSuggestions(selectedJob.jobName || '').catch(error => {
              console.error("Error fetching suggestions:", error);
              setMessage('Oops! Couldn’t load suggestions. Using default values.');
              return null;
            })
          ]).finally(() => {
            setIsLoadingJob(false);
          });
        }
      }, [selectedJobId, jobs]);

      const fetchJobs = async () => {
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 5000);
          const response = await fetch(`${SERVER_URL}/api/jobs`, { signal: controller.signal });
          clearTimeout(timeoutId);
          if (!response.ok) throw new Error('Failed to fetch jobs');
          const data = await response.json();
          setJobs(data);
        } catch (error) {
          console.error('Error fetching jobs:', error);
          if (error.name === 'AbortError') {
            setMessage('Oops! The server took too long to respond. Using cached data if available.');
          } else {
            setMessage('Oops! Couldn’t load jobs from the server. Using cached data if available.');
          }
        }
      };

      const fetchAllCostEstimates = async () => {
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 5000);
          const response = await fetch(`${SERVER_URL}/api/cost-estimates`, { signal: controller.signal });
          clearTimeout(timeoutId);
          if (!response.ok) throw new Error('Failed to fetch cost estimates');
          const data = await response.json();
          const estimatesMap = {};
          data.forEach(estimate => {
            estimatesMap[estimate.jobId] = {
              totalCost: estimate.totalCost || "",
              runningCost: estimate.runningCost || "",
              nextSteps: estimate.nextSteps || ''
            };
          });
          setCostEstimates(estimatesMap);
        } catch (error) {
          console.error('Error fetching cost estimates:', error);
          if (error.name === 'AbortError') {
            setMessage('Oops! The server took too long to respond. Using cached data if available.');
          } else {
            setMessage('Oops! Couldn’t load cost estimates from the server. Using cached data if available.');
          }
        }
      };

      const fetchCostEstimate = async (jobId) => {
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 5000);
          const response = await fetch(`${SERVER_URL}/api/cost-estimates/${jobId}`, { signal: controller.signal });
          clearTimeout(timeoutId);
          const data = await response.json();
          if (data && Object.keys(data).length > 0) {
            setCostEstimate({
              ...data,
              labor: {
                hours: data.labor.hours || "",
                technicians: data.labor.technicians || "",
                pricePerHour: data.labor.pricePerHour || "",
                totalLaborCost: data.labor.totalLaborCost || ""
              },
              runningCost: data.runningCost || "",
              nextSteps: data.nextSteps || ''
            });
          } else {
            setCostEstimate({
              labor: { hours: "", technicians: "", pricePerHour: "", totalLaborCost: "" },
              materials: [],
              materialMarkup: "",
              taxRate: "",
              specialSections: [],
              totalCost: "",
              runningCost: "",
              nextSteps: ''
            });
          }
        } catch (error) {
          setCostEstimate({
            labor: { hours: "", technicians: "", pricePerHour: "", totalLaborCost: "" },
            materials: [],
            materialMarkup: "",
            taxRate: "",
            specialSections: [],
            totalCost: "",
            runningCost: "",
            nextSteps: ''
          });
          throw error;
        }
      };

      const fetchSuggestions = async (jobName) => {
        if (!jobName) return;
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 5000);
          const response = await fetch(`${SERVER_URL}/api/suggestions/${encodeURIComponent(jobName)}`, { signal: controller.signal });
          clearTimeout(timeoutId);
          const data = await response.json();
          setSuggestions(data);
        } catch (error) {
          console.error("Error fetching suggestions:", error);
          setSuggestions({ averageCost: "", minCost: "", maxCost: "", count: 0 });
          throw error;
        }
      };

      const handleLogin = async (e) => {
        e.preventDefault();
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 5000);
          const response = await fetch(`${SERVER_URL}/api/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password }),
            signal: controller.signal
          });
          clearTimeout(timeoutId);
          const data = await response.json();
          setMessage(data.message);
          if (response.ok) {
            setIsLoggedIn(true);
            setUsername(data.username);
            setCreatedBy(data.username);
            setCurrentPage('dashboard');
          }
        } catch (error) {
          console.error('Error logging in:', error);
          if (error.name === 'AbortError') {
            setMessage('Oops! The server took too long to respond. Please check if the server is running.');
          } else {
            setMessage('Oops! Something went wrong. Make sure the server is running.');
          }
        }
      };

      const handleSignUp = async (e) => {
        e.preventDefault();
        if (password !== confirmPassword) {
          setMessage('Passwords do not match! Try again.');
          return;
        }
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 5000);
          const response = await fetch(`${SERVER_URL}/api/signup`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password }),
            signal: controller.signal
          });
          clearTimeout(timeoutId);
          const data = await response.text();
          setMessage(data);
          if (response.ok) {
            setIsSigningUp(false);
          }
        } catch (error) {
          console.error('Error signing up:', error);
          if (error.name === 'AbortError') {
            setMessage('Oops! The server took too long to respond. Please check if the server is running.');
          } else {
            setMessage('Oops! Something went wrong. Make sure the server is running.');
          }
        }
      };

      const handleCreateJob = async (e) => {
        e.preventDefault();
        setMessage(''); // Clear any previous messages
        console.log("Create Job button clicked!"); // Test if the button is working
        if (!jobName) {
          setMessage('Please fill in the Job Name to create a job!');
          return;
        }
        // Create a temporary job ID for local use
        const tempJobId = `temp_${Date.now()}`;
        const newJob = {
          _id: tempJobId,
          jobName,
          dateEntered: dateEntered || null,
          createdBy: createdBy || username || '',
          status: 'Planning',
          notes: ''
        };
        // Add the job to the list right away
        setJobs(prevJobs => [...prevJobs, newJob]);
        setMessage('Job added locally! Trying to save it to the server...');
        setJobName('');
        setCreatedBy('');
        setDateEntered('');
        // Try to save the job to the server
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 5000);
          const response = await fetch(`${SERVER_URL}/api/jobs`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              jobName,
              dateEntered: dateEntered || null,
              createdBy: createdBy || username || '',
              status: 'Planning',
              notes: ''
            }),
            signal: controller.signal
          });
          clearTimeout(timeoutId);
          if (!response.ok) {
            const errorData = await response.text();
            throw new Error(errorData || 'Failed to create job');
          }
          const savedJob = await response.json();
          // Update the job with the real ID from the server
          setJobs(prevJobs => prevJobs.map(job => job._id === tempJobId ? savedJob : job));
          setMessage('Job created successfully on the server! ⚡');
          await fetchJobs();
        } catch (error) {
          console.error('Error creating job:', error);
          if (error.name === 'AbortError') {
            setMessage('Oops! The server took too long to respond. The job is saved locally, but please check if the server is running.');
          } else {
            setMessage(`Oops! Something went wrong: ${error.message}. The job is saved locally, but please check the server.`);
          }
        }
      };

      const handleDeleteJob = async (id) => {
        const job = jobs.find(job => job._id === id);
        const confirmDelete = window.confirm(`Are you sure you want to delete the job "${job.jobName}"?`);
        if (!confirmDelete) return;
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 5000);
          const response = await fetch(`${SERVER_URL}/api/jobs/${id}`, {
            method: 'DELETE',
            signal: controller.signal
          });
          clearTimeout(timeoutId);
          if (!response.ok) throw new Error('Failed to delete job');
          setMessage('Job deleted successfully! ⚡');
          setJobs(prevJobs => prevJobs.filter(job => job._id !== id));
          await fetchJobs();
          await fetchAllCostEstimates();
        } catch (error) {
          console.error('Error deleting job:', error);
          if (error.name === 'AbortError') {
            setMessage('Oops! The server took too long to respond. The job is deleted locally, but please check if the server is running.');
          } else {
            setMessage('Oops! Something went wrong. Make sure the server is running.');
          }
        }
      };

      const handleUpdateJobStatus = async (id, status) => {
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 5000);
          const response = await fetch(`${SERVER_URL}/api/jobs/${id}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ status }),
            signal: controller.signal
          });
          clearTimeout(timeoutId);
          if (!response.ok) throw new Error('Failed to update job status');
          await fetchJobs();
        } catch (error) {
          console.error('Error updating job status:', error);
          if (error.name === 'AbortError') {
            setMessage('Oops! The server took too long to respond. Please check if the server is running.');
          } else {
            setMessage('Oops! Something went wrong. Make sure the server is running.');
          }
        }
      };

      const handleUpdateJobNotes = async (id, notes) => {
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 5000);
          const response = await fetch(`${SERVER_URL}/api/jobs/${id}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ notes }),
            signal: controller.signal
          });
          clearTimeout(timeoutId);
          if (!response.ok) throw new Error('Failed to update job notes');
          await fetchJobs();
          localStorage.setItem(`jobNotes_${id}`, notes);
        } catch (error) {
          console.error('Error updating job notes:', error);
          if (error.name === 'AbortError') {
            setMessage('Oops! The server took too long to respond. Please check if the server is running.');
          } else {
            setMessage('Oops! Something went wrong. Make sure the server is running.');
          }
        }
      };

      const handleSaveEstimate = async (e) => {
        e.preventDefault();
        const job = jobs.find(job => job._id === selectedJobId);
        console.log("Job data when saving estimate:", job);
        if (!job || !job.jobName) {
          setMessage('Cannot create an estimate because the job name is missing! Please go back and create the job again.');
          return;
        }
        const hours = parseFloat(costEstimate.labor.hours || 0);
        const technicians = parseInt(costEstimate.labor.technicians || 0);
        const pricePerHour = parseFloat(costEstimate.labor.pricePerHour || 0);
        const totalLaborCost = hours * technicians * pricePerHour;
        let materialCost = costEstimate.materials.reduce((sum, item) => sum + (parseFloat(item.cost || 0) * parseInt(item.quantity || 0)), 0);
        const markup = materialCost * (parseFloat(costEstimate.materialMarkup || 0) / 100);
        const specialCost = costEstimate.specialSections.reduce((sum, section) => sum + parseFloat(section.cost || 0), 0);
        const subtotal = totalLaborCost + materialCost + markup + specialCost;
        const tax = subtotal * (parseFloat(costEstimate.taxRate || 0) / 100);
        const totalCost = subtotal + tax;

        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 5000);
          const response = await fetch(`${SERVER_URL}/api/cost-estimates`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              jobId: selectedJobId,
              labor: { ...costEstimate.labor, totalLaborCost },
              materials: costEstimate.materials,
              materialMarkup: costEstimate.materialMarkup,
              taxRate: costEstimate.taxRate,
              specialSections: costEstimate.specialSections,
              totalCost,
              runningCost: costEstimate.runningCost,
              nextSteps: costEstimate.nextSteps
            }),
            signal: controller.signal
          });
          clearTimeout(timeoutId);
          if (!response.ok) throw new Error('Failed to save cost estimate');
          setCostEstimate({ ...costEstimate, totalCost });
          await fetchAllCostEstimates();
          const selectedJob = jobs.find(job => job._id === selectedJobId);
          if (selectedJob) await fetchSuggestions(selectedJob.jobName);
          localStorage.setItem(`jobNextSteps_${selectedJobId}`, costEstimate.nextSteps);
        } catch (error) {
          console.error('Error saving cost estimate:', error);
          if (error.name === 'AbortError') {
            setMessage('Oops! The server took too long to respond. Please check if the server is running.');
          } else {
            setMessage('Oops! Something went wrong. Make sure the server is running.');
          }
        }
      };

      const handleAddMaterial = () => {
        if (!newMaterial.name || !newMaterial.cost || !newMaterial.quantity) {
          setMessage('Please fill in all material fields (name, cost, quantity)!');
          return;
        }
        setCostEstimate({
          ...costEstimate,
          materials: [...costEstimate.materials, { ...newMaterial }]
        });
        setNewMaterial({ name: '', cost: '', quantity: '' });
        setMessage('');
      };

      const handleAddCustomMaterial = () => {
        if (!newCustomMaterial.name || !newCustomMaterial.cost) {
          setMessage('Please enter a material name and cost!');
          return;
        }
        setCustomMaterials([...customMaterials, { name: newCustomMaterial.name }]);
        setNewCustomMaterial({ name: '', cost: '' });
        setMessage('');
      };

      const handleAddSpecialSection = () => {
        if (!newSpecialSection.name || !newSpecialSection.cost) {
          setMessage('Please fill in the special section name and cost!');
          return;
        }
        setCostEstimate({
          ...costEstimate,
          specialSections: [...costEstimate.specialSections, newSpecialSection]
        });
        setNewSpecialSection({ name: '', cost: '', description: '' });
        setMessage('');
      };

      if (currentPage === 'login') {
        return (
          <div className="container">
            <div className="header">
              <i className="fas fa-bolt"></i>
              <h1>Circle City Estimator/Job Tracker ⚡</h1>
            </div>
            {isSigningUp ? (
              <form onSubmit={handleSignUp} className="space-y-4">
                <h2 className="text-center">Sign Up</h2>
                <div className="relative">
                  <i className="fas fa-user"></i>
                  <input
                    type="text"
                    placeholder="Username"
                    value={username}
                    onChange={(e) => setUsername(e.target.value)}
                    className="p-2"
                  />
                </div>
                <div className="relative">
                  <i className="fas fa-lock"></i>
                  <input
                    type={showPassword ? "text" : "password"}
                    placeholder="Password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    className="p-2"
                  />
                </div>
                <div className="relative">
                  <i className="fas fa-lock"></i>
                  <input
                    type={showPassword ? "text" : "password"}
                    placeholder="Confirm Password"
                    value={confirmPassword}
                    onChange={(e) => setConfirmPassword(e.target.value)}
                    className="p-2"
                  />
                </div>
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="w-full bg-gray-500"
                >
                  <i className={showPassword ? "fas fa-eye-slash" : "fas fa-eye"}></i>
                  {showPassword ? "Hide Password" : "Show Password"}
                </button>
                <button type="submit" className="w-full">
                  <i className="fas fa-user-plus"></i> Sign Up ⚡
                </button>
                <button
                  onClick={() => setIsSigningUp(false)}
                  className="w-full bg-gray-500"
                >
                  <i className="fas fa-arrow-left"></i> Back to Login
                </button>
                {message && <p className="text-center text-red-600">{message}</p>}
                <div className="footer-text">
                  <p className="footer-text-powered">Powered by The Ackme Co</p>
                  <p className="footer-text-built">Built by Grok ⚡</p>
                </div>
              </form>
            ) : (
              <form onSubmit={handleLogin} className="space-y-4">
                <h2 className="text-center">Login</h2>
                <div className="relative">
                  <i className="fas fa-user"></i>
                  <input
                    type="text"
                    placeholder="Username"
                    value={username}
                    onChange={(e) => setUsername(e.target.value)}
                    className="p-2"
                  />
                </div>
                <div className="relative">
                  <i className="fas fa-lock"></i>
                  <input
                    type={showPassword ? "text" : "password"}
                    placeholder="Password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    className="p-2"
                  />
                </div>
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="w-full bg-gray-500"
                >
                  <i className={showPassword ? "fas fa-eye-slash" : "fas fa-eye"}></i>
                  {showPassword ? "Hide Password" : "Show Password"}
                </button>
                <button type="submit" className="w-full">
                  <i className="fas fa-sign-in-alt"></i> Login ⚡
                </button>
                <button
                  onClick={() => setIsSigningUp(true)}
                  className="w-full"
                >
                  <i className="fas fa-user-plus"></i> Sign Up ⚡
                </button>
                {message && <p className="text-center text-red-600">{message}</p>}
                <div className="footer-text">
                  <p className="footer-text-powered">Powered by The Ackme Co</p>
                  <p className="footer-text-built">Built by Grok ⚡</p>
                </div>
              </form>
            )}
          </div>
        );
      }

      if (selectedJobId) {
        const selectedJob = jobs.find(job => job._id === selectedJobId);
        if (isLoadingJob) {
          return (
            <div className="container">
              <p className="text-center">Loading job details... ⏳</p>
            </div>
          );
        }
        if (!selectedJob) {
          return (
            <div className="container">
              <p className="text-center">Job not found! Please go back to the dashboard.</p>
              <button
                onClick={() => setSelectedJobId(null)}
                className="w-full mt-4"
              >
                <i className="fas fa-arrow-left"></i> Back to Dashboard ⚡
              </button>
            </div>
          );
        }

        const hours = parseFloat(costEstimate.labor.hours || 0);
        const technicians = parseInt(costEstimate.labor.technicians || 0);
        const pricePerHour = parseFloat(costEstimate.labor.pricePerHour || 0);
        const totalLaborCost = hours * technicians * pricePerHour;
        let materialCost = costEstimate.materials.reduce((sum, item) => sum + (parseFloat(item.cost || 0) * parseInt(item.quantity || 0)), 0);
        const markup = materialCost * (parseFloat(costEstimate.materialMarkup || 0) / 100);
        const specialCost = costEstimate.specialSections.reduce((sum, section) => sum + parseFloat(section.cost || 0), 0);
        const subtotal = totalLaborCost + materialCost + markup + specialCost;
        const tax = subtotal * (parseFloat(costEstimate.taxRate || 0) / 100);
        const totalCost = subtotal + tax;
        const remainingCost = totalCost - parseFloat(costEstimate.runningCost || 0);

        const exportToPDF = () => {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();
          doc.setFillColor(232, 33, 39);
          doc.rect(0, 0, 210, 30, 'F');
          doc.setFontSize(20);
          doc.setTextColor(255, 255, 255);
          doc.text('Circle City Estimator/Job Tracker ⚡', 20, 20);
          doc.setFontSize(14);
          doc.setTextColor(0, 0, 0);
          doc.text(`Estimate for ${selectedJob.jobName}`, 20, 40);
          doc.setFontSize(10);
          doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 20, 50);
          doc.setFontSize(12);
          let y = 60;
          doc.text(`Labor Cost: $${totalLaborCost.toFixed(2)}`, 20, y);
          y += 10;
          doc.text(`Material Cost: $${materialCost.toFixed(2)}`, 20, y);
          y += 10;
          doc.text(`Material Markup: $${markup.toFixed(2)}`, 20, y);
          y += 10;
          doc.text(`Special Sections Cost: $${specialCost.toFixed(2)}`, 20, y);
          y += 10;
          doc.text(`Subtotal: $${subtotal.toFixed(2)}`, 20, y);
          y += 10;
          doc.text(`Tax: $${tax.toFixed(2)}`, 20, y);
          y += 10;
          doc.text(`Estimated Total Cost: $${totalCost.toFixed(2)}`, 20, y);
          y += 10;
          doc.text(`Running Cost: $${parseFloat(costEstimate.runningCost || 0).toFixed(2)}`, 20, y);
          y += 10;
          doc.text(`Remaining Cost: $${remainingCost.toFixed(2)}`, 20, y);
          y += 10;
          if (costEstimate.nextSteps) {
            doc.text(`Next Steps: ${costEstimate.nextSteps}`, 20, y);
          }
          doc.save(`${selectedJob.jobName}_Estimate.pdf`);
        };

        return (
          <div className="container">
            <div className="header">
              <i className="fas fa-bolt"></i>
              <h1>Estimate & Tracker for {selectedJob.jobName} ⚡</h1>
            </div>
            <div className="flex justify-between mb-4">
              <button
                onClick={() => {
                  setSelectedJobId(null);
                  setCostEstimate({
                    labor: { hours: "", technicians: "", pricePerHour: "", totalLaborCost: "" },
                    materials: [],
                    materialMarkup: "",
                    taxRate: "",
                    specialSections: [],
                    totalCost: "",
                    runningCost: "",
                    nextSteps: ''
                  });
                }}
              >
                <i className="fas fa-arrow-left"></i> Back to Dashboard ⚡
              </button>
              <button onClick={exportToPDF}>
                <i className="fas fa-file-pdf"></i> Export to PDF ⚡
              </button>
            </div>
            {suggestions.count > 0 && (
              <div className="suggestions">
                <h2>Suggested Pricing (Based on {suggestions.count} Similar Jobs) ⚡</h2>
                <p>Average Cost: $${parseFloat(suggestions.averageCost || 0).toFixed(2)}</p>
                <p>Range: $${parseFloat(suggestions.minCost || 0).toFixed(2)} - $${parseFloat(suggestions.maxCost || 0).toFixed(2)}</p>
              </div>
            )}
            <form onSubmit={handleSaveEstimate} className="space-y-4">
              <div>
                <h2>Labor ⚡</h2>
                <div className="grid grid-cols-2 gap-4">
                  <div className="relative">
                    <i className="fas fa-clock"></i>
                    <label>Hours</label>
                    <input
                      type="number"
                      placeholder="Enter hours"
                      value={costEstimate.labor.hours}
                      onChange={(e) => setCostEstimate({
                        ...costEstimate,
                        labor: { ...costEstimate.labor, hours: e.target.value }
                      })}
                      className="p-2"
                    />
                  </div>
                  <div className="relative">
                    <i className="fas fa-users"></i>
                    <label>Number of Electricians</label>
                    <input
                      type="number"
                      placeholder="Enter number of electricians"
                      value={costEstimate.labor.technicians}
                      onChange={(e) => setCostEstimate({
                        ...costEstimate,
                        labor: { ...costEstimate.labor, technicians: e.target.value }
                      })}
                      className="p-2"
                    />
                  </div>
                  <div className="relative">
                    <i className="fas fa-dollar-sign"></i>
                    <label>Price per Hour ($)</label>
                    <input
                      type="number"
                      placeholder="Enter price per hour"
                      value={costEstimate.labor.pricePerHour}
                      onChange={(e) => setCostEstimate({
                        ...costEstimate,
                        labor: { ...costEstimate.labor, pricePerHour: e.target.value }
                      })}
                      className="p-2"
                    />
                  </div>
                  <div className="relative">
                    <i className="fas fa-calculator"></i>
                    <label>Total Labor Cost ($)</label>
                    <input
                      type="text"
                      value={totalLaborCost ? totalLaborCost.toFixed(2) : ""}
                      readOnly
                      className="p-2 bg-gray-500"
                    />
                  </div>
                </div>
              </div>
              <div>
                <h2>Materials ⚡</h2>
                <div className="mb-4">
                  <label>Material Type</label>
                  <div className="relative">
                    <i className="fas fa-tools"></i>
                    <select
                      value={materialType}
                      onChange={(e) => {
                        setMaterialType(e.target.value);
                        setCostEstimate({ ...costEstimate, materials: [] });
                      }}
                    >
                      <option value="Residential">Residential</option>
                      <option value="Commercial">Commercial</option>
                    </select>
                  </div>
                </div>
                <div className="grid grid-cols-3 gap-4">
                  <div className="relative">
                    <i className="fas fa-tools"></i>
                    <label>Material Name</label>
                    <select
                      value={newMaterial.name}
                      onChange={(e) => setNewMaterial({
                        ...newMaterial,
                        name: e.target.value
                      })}
                      className="p-2"
                    >
                      <option value="">Select Material</option>
                      {availableMaterials.map((mat, i) => (
                        <option key={i} value={mat.name}>{mat.name}</option>
                      ))}
                    </select>
                  </div>
                  <div className="relative">
                    <i className="fas fa-dollar-sign"></i>
                    <label>Price ($)</label>
                    <input
                      type="number"
                      placeholder="Enter price"
                      value={newMaterial.cost}
                      onChange={(e) => setNewMaterial({ ...newMaterial, cost: e.target.value })}
                      className="p-2"
                    />
                  </div>
                  <div className="relative">
                    <i className="fas fa-sort-numeric-up"></i>
                    <label>Quantity</label>
                    <input
                      type="number"
                      placeholder="Enter quantity"
                      value={newMaterial.quantity}
                      onChange={(e) => setNewMaterial({ ...newMaterial, quantity: e.target.value })}
                      className="p-2"
                    />
                  </div>
                </div>
                {newMaterial.name && (
                  <div className="mt-4">
                    <h3>Add Custom Material ⚡</h3>
                    <div className="grid grid-cols-2 gap-4">
                      <div className="relative">
                        <i className="fas fa-tools"></i>
                        <label>Material Name</label>
                        <input
                          type="text"
                          placeholder="Material Name"
                          value={newCustomMaterial.name}
                          onChange={(e) => setNewCustomMaterial({ ...newCustomMaterial, name: e.target.value })}
                          className="p-2"
                        />
                      </div>
                      <div className="relative">
                        <i className="fas fa-dollar-sign"></i>
                        <label>Cost ($)</label>
                        <input
                          type="number"
                          placeholder="Enter cost"
                          step="0.01"
                          value={newCustomMaterial.cost}
                          onChange={(e) => setNewCustomMaterial({ ...newCustomMaterial, cost: e.target.value })}
                          className="p-2"
                        />
                      </div>
                    </div>
                    <button
                      type="button"
                      onClick={handleAddCustomMaterial}
                      className="w-full mt-2"
                    >
                      <i className="fas fa-plus"></i> Add Custom Material ⚡
                    </button>
                  </div>
                )}
                <button
                  type="button"
                  onClick={handleAddMaterial}
                  className="w-full mb-2 mt-2"
                >
                  <i className="fas fa-plus"></i> Add Material ⚡
                </button>
                <div className="table-container">
                  <table className="w-full">
                    <thead>
                      <tr>
                        <th>Name</th>
                        <th>Cost ($)</th>
                        <th>Quantity</th>
                        <th>Total ($)</th>
                      </tr>
                    </thead>
                    <tbody>
                      {costEstimate.materials.map((material, index) => (
                        <tr key={index}>
                          <td>{material.name}</td>
                          <td>{parseFloat(material.cost || 0).toFixed(2)}</td>
                          <td>{material.quantity}</td>
                          <td>{(parseFloat(material.cost || 0) * parseInt(material.quantity || 0)).toFixed(2)}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
              <div>
                <h2>Material Markup (%) ⚡</h2>
                <div className="relative">
                  <i className="fas fa-percentage"></i>
                  <input
                    type="number"
                    placeholder="Enter markup percentage"
                    value={costEstimate.materialMarkup}
                    onChange={(e) => setCostEstimate({ ...costEstimate, materialMarkup: e.target.value })}
                    className="p-2"
                  />
                </div>
              </div>
              <div>
                <h2>Tax Rate (%) ⚡</h2>
                <div className="relative">
                  <i className="fas fa-percentage"></i>
                  <input
                    type="number"
                    placeholder="Enter tax rate"
                    value={costEstimate.taxRate}
                    onChange={(e) => setCostEstimate({ ...costEstimate, taxRate: e.target.value })}
                    className="p-2"
                  />
                </div>
              </div>
              <div>
                <h2>Running Cost ($) ⚡</h2>
                <div className="relative">
                  <i className="fas fa-dollar-sign"></i>
                  <input
                    type="number"
                    placeholder="Enter current cost of the job"
                    value={costEstimate.runningCost}
                    onChange={(e) => setCostEstimate({ ...costEstimate, runningCost: e.target.value })}
                    className="p-2"
                  />
                </div>
              </div>
              <div>
                <h2>Next Steps ⚡</h2>
                <div className="relative">
                  <i className="fas fa-align-left"></i>
                  <textarea
                    placeholder="What’s next?"
                    value={costEstimate.nextSteps || localStorage.getItem(`jobNextSteps_${selectedJobId}`) || ''}
                    onChange={(e) => setCostEstimate({ ...costEstimate, nextSteps: e.target.value })}
                    className="p-2"
                  />
                </div>
              </div>
              <div>
                <h2>Special Sections ⚡</h2>
                <div className="relative">
                  <i className="fas fa-clipboard"></i>
                  <input
                    type="text"
                    placeholder="Section Name"
                    value={newSpecialSection.name}
                    onChange={(e) => setNewSpecialSection({ ...newSpecialSection, name: e.target.value })}
                    className="p-2 mb-2"
                  />
                </div>
                <div className="relative">
                  <i className="fas fa-dollar-sign"></i>
                  <input
                    type="number"
                    placeholder="Cost ($)"
                    value={newSpecialSection.cost}
                    onChange={(e) => setNewSpecialSection({ ...newSpecialSection, cost: e.target.value })}
                    className="p-2 mb-2"
                  />
                </div>
                <div className="relative">
                  <i className="fas fa-align-left"></i>
                  <textarea
                    placeholder="Description"
                    value={newSpecialSection.description}
                    onChange={(e) => setNewSpecialSection({ ...newSpecialSection, description: e.target.value })}
                    className="p-2 mb-2"
                  />
                </div>
                <button
                  type="button"
                  onClick={handleAddSpecialSection}
                  className="w-full"
                >
                  <i className="fas fa-plus"></i> Add Special Section ⚡
                </button>
                <div className="table-container">
                  <table className="w-full mt-2">
                    <thead>
                      <tr>
                        <th>Name</th>
                        <th>Cost ($)</th>
                        <th>Description</th>
                      </tr>
                    </thead>
                    <tbody>
                      {costEstimate.specialSections.map((section, index) => (
                        <tr key={index}>
                          <td>{section.name}</td>
                          <td>{parseFloat(section.cost || 0).toFixed(2)}</td>
                          <td>{section.description}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
              <div>
                <h2>Cost Breakdown ⚡</h2>
                <div className="table-container">
                  <table className="w-full">
                    <tbody>
                      <tr>
                        <td>Labor Cost</td>
                        <td>${totalLaborCost.toFixed(2)}</td>
                      </tr>
                      <tr>
                        <td>Material Cost</td>
                        <td>${materialCost.toFixed(2)}</td>
                      </tr>
                      <tr>
                        <td>Material Markup</td>
                        <td>${markup.toFixed(2)}</td>
                      </tr>
                      <tr>
                        <td>Special Sections Cost</td>
                        <td>${specialCost.toFixed(2)}</td>
                      </tr>
                      <tr>
                        <td>Subtotal</td>
                        <td>${subtotal.toFixed(2)}</td>
                      </tr>
                      <tr>
                        <td>Tax</td>
                        <td>${tax.toFixed(2)}</td>
                      </tr>
                      <tr>
                        <td>Estimated Total Cost</td>
                        <td>${totalCost.toFixed(2)}</td>
                      </tr>
                      <tr>
                        <td>Running Cost</td>
                        <td>${parseFloat(costEstimate.runningCost || 0).toFixed(2)}</td>
                      </tr>
                      <tr>
                        <td>Remaining Cost</td>
                        <td>${remainingCost.toFixed(2)}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
              <button type="submit" className="w-full">
                <i className="fas fa-save"></i> Save Estimate ⚡
              </button>
              {message && <p className="text-center text-red-600 mt-2">{message}</p>}
            </form>
          </div>
        );
      }

      const userJobs = jobs.filter(job => job.createdBy === createdBy || job.createdBy === '' || !job.createdBy);
      const runningTotal = userJobs.reduce((sum, job) => sum + parseFloat(costEstimates[job._id]?.totalCost || 0), 0);
      const totalRunningCost = userJobs.reduce((sum, job) => sum + parseFloat(costEstimates[job._id]?.runningCost || 0), 0);
      const totalJobs = userJobs.length;
      const jobsInProgress = userJobs.filter(job => job.status === 'In Progress').length;

      return (
        <div className="container">
          <div className="header">
            <i className="fas fa-bolt"></i>
            <h1>Circle City Dashboard ⚡</h1>
          </div>
          <div className="flex justify-end mb-4">
            <button
              onClick={() => setCurrentPage('login')}
              className="bg-gray-500"
            >
              <i className="fas fa-sign-out-alt"></i> Logout ⚡
            </button>
          </div>
          <p className="text-center text-lg mb-4">Welcome to the {username}! ⚡</p>
          <div className="dashboard-grid">
            <div className="dashboard-card">
              <h3>Total Jobs</h3>
              <p>{totalJobs}</p>
            </div>
            <div className="dashboard-card">
              <h3>Estimated Total</h3>
              <p>${runningTotal.toFixed(2)}</p>
            </div>
            <div className="dashboard-card">
              <h3>Jobs In Progress</h3>
              <p>{jobsInProgress}</p>
            </div>
            <div className="dashboard-card">
              <h3>Running Jobs Cost</h3>
              <p>${totalRunningCost.toFixed(2)}</p>
            </div>
          </div>
          <div className="mb-4">
            <h2>Create New Job ⚡</h2>
            {message && <p className="text-center text-red-600 mb-4">{message}</p>}
            <form onSubmit={handleCreateJob} className="space-y-4">
              <div className="relative">
                <i className="fas fa-briefcase"></i>
                <input
                  type="text"
                  placeholder="Job Name"
                  value={jobName}
                  onChange={(e) => setJobName(e.target.value)}
                  className="p-2"
                />
              </div>
              <div className="relative">
                <i className="fas fa-user"></i>
                <label>Job Created By</label>
                <input
                  type="text"
                  placeholder="Your name (optional)"
                  value={createdBy}
                  onChange={(e) => setCreatedBy(e.target.value)}
                  className="p-2"
                />
              </div>
              <div className="relative">
                <i className="fas fa-calendar-day"></i>
                <label>Date Entered</label>
                <input
                  type="date"
                  value={dateEntered}
                  onChange={(e) => setDateEntered(e.target.value)}
                  className="p-2"
                />
              </div>
              <button type="submit" className="w-full">
                <i className="fas fa-plus"></i> Create Job ⚡
              </button>
            </form>
          </div>
          <h2>Your Jobs ⚡</h2>
          <div className="table-container">
            <table className="w-full">
              <thead>
                <tr>
                  <th>Job Name</th>
                  <th>Created By</th>
                  <th>Status</th>
                  <th>Notes</th>
                  <th>Estimated Total ($)</th>
                  <th>Running Cost ($)</th>
                  <th>Next Steps</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {userJobs.map(job => (
                  <tr key={job._id}>
                    <td>{job.jobName}</td>
                    <td>{job.createdBy || 'N/A'}</td>
                    <td>
                      <select
                        value={job.status}
                        onChange={(e) => handleUpdateJobStatus(job._id, e.target.value)}
                        className="p-1"
                      >
                        <option value="Planning">Planning</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Completed">Completed</option>
                      </select>
                    </td>
                    <td>
                      <input
                        type="text"
                        value={job.notes || localStorage.getItem(`jobNotes_${job._id}`) || ''}
                        onChange={(e) => handleUpdateJobNotes(job._id, e.target.value)}
                        className="w-full p-1"
                      />
                    </td>
                    <td>${parseFloat(costEstimates[job._id]?.totalCost || 0).toFixed(2)}</td>
                    <td>${parseFloat(costEstimates[job._id]?.runningCost || 0).toFixed(2)}</td>
                    <td>{costEstimates[job._id]?.nextSteps || '-'}</td>
                    <td className="space-x-4">
                      <button
                        onClick={() => {
                          setSelectedJobId(job._id);
                          setIsLoadingJob(true);
                        }}
                      >
                        <i className="fas fa-calculator"></i> Estimate ⚡
                      </button>
                      <button
                        onClick={() => handleDeleteJob(job._id)}
                        className="bg-red-600"
                      >
                        <i className="fas fa-trash"></i> Delete
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    const root = createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
